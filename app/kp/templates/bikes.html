{% extends "base.html" %}
{% block content %}
  <h1>Список велосипедов</h1>
  {% if current_user.is_authenticated %}
    <a href="{{ url_for('kp.add_bike') }}">Добавить велосипед</a>
    <a href="{{ url_for('kp.bike_detail', bike_id=bike.id) }}" class="btn btn-outline-primary btn-sm">Подробнее</a>
  {% endif %}
  <div class="bikes">
    {% for bike in bikes %}
      <div class="bike-card">
        <h3>{{ bike.title }}</h3>
        <p>{{ bike.description }}</p>
        <p>Цена: {{ bike.price }} руб.</p>
        {% if current_user.id == bike.owner_id %}
          <a href="{{ url_for('delete_bike', id=bike.id) }}">Удалить</a>
        {% endif %}
      </div>
    {% endfor %}
  </div>

  <form action="{{ url_for('search') }}" method="GET">
  <input type="text" name="q" placeholder="Поиск...">
  <button type="submit">Найти</button>
  </form>

<form action="{{ url_for('bikes') }}" method="GET">
  <select name="category">
    <option value="">Все категории</option>
    {% for cat in categories %}
      <option value="{{ cat[0] }}">{{ cat[0] }}</option>
    {% endfor %}
  </select>
  <input type="number" name="min_price" placeholder="Мин цена">
  <input type="number" name="max_price" placeholder="Макс цена">
  <button type="submit">Фильтр</button>
</form>

<div class="likes">
  <form action="{{ url_for('like', bike_id=bike.id) }}" method="POST">
    <button type="submit">❤️ {{ bike.likes|length }}</button>
  </form>
</div>


<div class="card">
    <img src="{{ bike.image_url }}" class="card-img-top" alt="Фото">
    <div class="card-body">
        <h5 class="card-title">{{ bike.title }}</h5>
        <p class="card-text">{{ bike.description[:100] }}...</p>
        <p><strong>Цена:</strong> {{ bike.price }} ₽</p>
        
        {% if current_user.is_authenticated %}
            <p><strong>Продавец:</strong> {{ bike.owner.username }}</p>
            <a href="{{ url_for('kp.bike_detail', bike_id=bike.id) }}" class="btn btn-outline-primary btn-sm">Подробнее</a>
        {% else %}
            <p><em>Зарегистрируйтесь, чтобы увидеть контактную информацию</em></p>
            <a href="{{ url_for('kp.login') }}" class="btn btn-warning btn-sm">Войти</a>
        {% endif %}
    </div>
</div>

<div class="comments">
  <h3>Комментарии</h3>
  {% if current_user.is_authenticated %}
    <form method="POST">
      <textarea name="comment" required></textarea>
      <button type="submit">Отправить</button>
    </form>
  {% endif %}
  {% for comment in bike.comments %}
    <p><strong>{{ comment.author.username }}:</strong> {{ comment.text }}</p>
  {% endfor %}
</div>
{% endblock %}